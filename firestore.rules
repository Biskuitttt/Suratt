rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // Allow reading from specialCodes collection (needed for code validation)
    match /specialCodes/{codeId} {
      allow read: if true; // Allow anyone to read special codes for validation
      allow write: if request.auth != null; // Only authenticated users can modify
    }

    // Allow reading from specialCodes subcollections (like images)
    match /specialCodes/{codeId}/{document=**} {
      allow read: if true; // Allow anyone to read images/data within special codes
      allow write: if request.auth != null; // Only authenticated users can modify
    }

    // Allow reading from Peserta collection (needed for photo references)
    match /Peserta/{participantId} {
      allow read: if true; // Allow anyone to read participant data for photos
      allow write: if request.auth != null; // Only authenticated users can modify
    }

    // Allow reading from Peserta subcollections (like photo documents)
    match /Peserta/{participantId}/{document=**} {
      allow read: if true; // Allow anyone to read photo references within participant docs
      allow write: if request.auth != null; // Only authenticated users can modify
    }

    // Default deny all other collections (users are in Firebase Auth, not Firestore)
    match /{document=**} {
      allow read, write: if false;
    }
  }
}